<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>çŒ«ã‚’æ¢ã™ã‚²ãƒ¼ãƒ </title>
  <style>
    body {
      font-family: system-ui, -apple-system, "Hiragino Sans", "Noto Sans JP", sans-serif;
      margin: 16px;
    }
    canvas {
      border: 1px solid #aaa;
      border-radius: 10px;
      display: block;
      background: #f9f9f9;
      max-width: 100%;
      height: auto;
    }
    .info {
      margin-top: 10px;
      font-weight: 700;
    }
    .hint {
      margin-top: 6px;
      color: #555;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <h2>çŒ«ã‚’æ¢ã™ã‚²ãƒ¼ãƒ ï¼ˆã‚¯ãƒªãƒƒã‚¯ã§æ¢ãã†ï¼‰</h2>
  <canvas id="game" width="800" height="540"></canvas>
  <div class="info" id="info">èƒŒæ™¯ã®ä¸­ã«çŒ«ãŒéš ã‚Œã¦ã„ã¾ã™ã€‚çŒ«ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦è¦‹ã¤ã‘ã‚ˆã†ï¼</div>
  <div class="hint">â€» cat.png ã¨ background.jpg ã‚’ã“ã®HTMLã¨åŒã˜ãƒ•ã‚©ãƒ«ãƒ€ã«ç½®ã„ã¦ãã ã•ã„ã€‚</div>

  <script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");
    const info = document.getElementById("info");

    const W = canvas.width;
    const H = canvas.height;

    // ===== ç”»åƒèª­ã¿è¾¼ã¿ =====
    const bgImg = new Image();
    bgImg.src = "background.jpg";

    const catImg = new Image();
    catImg.src = "cat.png";

    // ===== ã‚²ãƒ¼ãƒ çŠ¶æ…‹ =====
    let cleared = false;

    // çŒ«ã®è¡¨ç¤ºã‚µã‚¤ã‚ºï¼ˆç”»åƒã®å®Ÿã‚µã‚¤ã‚ºã«é–¢ä¿‚ãªãã“ã“ã§çµ±ä¸€ï¼‰
    const cat = {
      w: 90,
      h: 90,
      x: 0,
      y: 0,
      visible: true
    };

    // çŒ«ã®ä½ç½®ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«æ±ºã‚ã‚‹ï¼ˆèƒŒæ™¯ã‹ã‚‰ã¯ã¿å‡ºã•ãªã„ï¼‰
    function randomizeCatPosition() {
      cat.x = Math.floor(Math.random() * (W - cat.w));
      cat.y = Math.floor(Math.random() * (H - cat.h));
    }

    // ã‚¯ãƒªãƒƒã‚¯åº§æ¨™ã‚’ã‚­ãƒ£ãƒ³ãƒã‚¹åº§æ¨™ã«å¤‰æ›
    function getMousePos(evt) {
      const rect = canvas.getBoundingClientRect();
      const scaleX = canvas.width / rect.width;
      const scaleY = canvas.height / rect.height;
      return {
        x: (evt.clientX - rect.left) * scaleX,
        y: (evt.clientY - rect.top) * scaleY
      };
    }

    // å½“ãŸã‚Šåˆ¤å®šï¼ˆçŒ«ã®çŸ©å½¢ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸã‹ï¼‰
    function isHitCat(px, py) {
      return (
        px >= cat.x &&
        px <= cat.x + cat.w &&
        py >= cat.y &&
        py <= cat.y + cat.h
      );
    }

    // ===== ã‚¯ãƒªãƒƒã‚¯å‡¦ç† =====
    canvas.addEventListener("click", (e) => {
      if (cleared) return;

      const { x, y } = getMousePos(e);

      if (cat.visible && isHitCat(x, y)) {
        cleared = true;
        info.textContent = "ğŸ‰ ã‚¯ãƒªã‚¢ï¼çŒ«ã‚’è¦‹ã¤ã‘ã¾ã—ãŸï¼";
      } else {
        // å¤–ã—ãŸæ™‚ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆä»»æ„ï¼‰
        info.textContent = "ã†ãƒ¼ã‚“â€¦ãã“ã˜ã‚ƒãªã„ï¼ã‚‚ã†ä¸€åº¦æ¢ã—ã¦ã¿ã‚ˆã†ã€‚";
      }
    });

    // ===== æç”» =====
    function draw() {
      // èƒŒæ™¯
      ctx.clearRect(0, 0, W, H);
      ctx.drawImage(bgImg, 0, 0, W, H);

      // çŒ«
      if (!cleared && cat.visible) {
        ctx.drawImage(catImg, cat.x, cat.y, cat.w, cat.h);
      }

      // ã‚¯ãƒªã‚¢è¡¨ç¤ºï¼ˆã‚­ãƒ£ãƒ³ãƒã‚¹ä¸Šã«ã‚‚è¡¨ç¤ºï¼‰
      if (cleared) {
        ctx.fillStyle = "rgba(0,0,0,0.55)";
        ctx.fillRect(0, 0, W, H);

        ctx.fillStyle = "#fff";
        ctx.font = "bold 44px sans-serif";
        ctx.textAlign = "center";
        ctx.fillText("CLEAR!", W / 2, H / 2 - 10);

        ctx.font = "20px sans-serif";
        ctx.fillText("çŒ«ã‚’è¦‹ã¤ã‘ãŸï¼", W / 2, H / 2 + 30);

        ctx.textAlign = "left";
      }

      requestAnimationFrame(draw);
    }

    // ===== ç”»åƒãƒ­ãƒ¼ãƒ‰å®Œäº†ã‚’å¾…ã£ã¦é–‹å§‹ =====
    function startIfReady() {
      if (!bgImg.complete || !catImg.complete) return;
      // ç”»åƒãŒå£Šã‚Œã¦ã„ãŸã‚Š 0x0 ã®ã¨ãå¯¾ç­–ï¼ˆèª­ã¿è¾¼ã¿å¤±æ•—æ™‚ï¼‰
      if (bgImg.naturalWidth === 0 || catImg.naturalWidth === 0) {
        info.textContent = "ç”»åƒã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒ•ã‚¡ã‚¤ãƒ«åã¨å ´æ‰€ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚";
        return;
      }
      randomizeCatPosition();
      draw();
    }

    bgImg.onload = startIfReady;
    catImg.onload = startIfReady;

    // ã©ã¡ã‚‰ã‹ãŒã‚­ãƒ£ãƒƒã‚·ãƒ¥ã§å³completeã®ã¨ãã®ä¿é™º
    setTimeout(startIfReady, 50);
  </script>
</body>
</html>
